<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title data-i18n="app_title">Jupiter ‚Äì Interface</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="brand">
          <span class="logo" aria-hidden="true">ü™ê</span>
          <div>
            <p class="eyebrow">Jupiter</p>
            <h1 data-i18n="main_title">Cartographie &amp; Observabilit√©</h1>
            <p class="muted" data-i18n="main_subtitle">Interface sombre, minimaliste et extensible</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="context">
            <p class="label" data-i18n="served_root">Racine servie</p>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <p class="value" id="root-path" data-i18n="loading">Chargement‚Ä¶</p>
              <button class="ghost small" data-action="browse-root" title="Parcourir">üìÇ</button>
            </div>
          </div>
          <div class="actions">
            <button class="ghost" data-action="load-sample" data-i18n="sample_button">Exemple</button>
            <button class="primary" data-action="open-scan-modal" data-i18n="scan_button">Scan</button>
            <button class="primary" data-action="open-run-modal" data-i18n="run_button">Run</button>
            <button class="primary" data-action="start-watch" data-i18n="watch_button">Watch</button>
          </div>
        </div>
      </header>

      <div class="app-body">
        <nav class="app-nav" aria-label="Navigation principale">
          <button class="nav-btn active" data-view="dashboard" data-i18n="dashboard_view">Dashboard</button>
          <button class="nav-btn" data-view="analysis" data-i18n="analysis_view">Analyse</button>
          <button class="nav-btn" data-view="quality" data-i18n="quality_view">Qualit√©</button>
          <button class="nav-btn" data-view="diagnostics" data-i18n="diagnostic_view">Diagnostic</button>
          <button class="nav-btn" data-view="files" data-i18n="files_view">Fichiers</button>
          <button class="nav-btn" data-view="functions" data-i18n="functions_view">Fonctions</button>
          <button class="nav-btn" data-view="settings" data-i18n="settings_view">Param√®tres</button>
          <button class="nav-btn" data-view="plugins" data-i18n="plugins_view">Plugins</button>
        </nav>

        <main class="content">
          <section class="view" data-view="dashboard" aria-label="Vue tableau de bord">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="d_pano_eyebrow">Panorama</p>
                    <h2 data-i18n="d_pano_title">√âtat rapide du projet</h2>
                    <p class="muted" data-i18n="d_pano_subtitle">Statut, progression et licence Meeting.</p>
                  </div>
                  <div class="badges" id="status-badges"></div>
                </header>
                <div class="stats-grid" id="stats-grid"></div>
              </section>

              <section class="panel hidden" id="watch-panel">
                <header>
                  <div>
                    <p class="eyebrow">Temps r√©el</p>
                    <h2>Surveillance de fichiers</h2>
                  </div>
                  <div class="badges">
                      <span class="badge active">Watching</span>
                  </div>
                </header>
                <ul id="watch-events" class="event-list" style="max-height: 200px; overflow-y: auto; list-style: none; padding: 0;"></ul>
              </section>

              <section class="panel" id="upload-panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="d_upload_eyebrow">Point d'entr√©e</p>
                    <h2 data-i18n="d_upload_title">Charger un rapport</h2>
                    <p class="muted" data-i18n="d_upload_subtitle">D√©posez un fichier <code>.json</code> g√©n√©r√© par <code>jupiter scan</code> ou utilisez l'exemple.</p>
                  </div>
                </header>
                <div class="uploader" id="dropzone">
                  <div>
                    <p class="muted" data-i18n="d_upload_prompt">Glissez un rapport ou cliquez pour parcourir.</p>
                    <p class="small" data-i18n="d_upload_compat">Compatible avec les scans statiques et les futures analyses incr√©mentales.</p>
                  </div>
                  <input type="file" id="report-input" accept="application/json" />
                </div>
                <div class="upload-meta" id="upload-meta"></div>
              </section>
            </div>
          </section>

          <section class="view hidden" data-view="analysis" aria-label="Vue analyse">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="a_overview_eyebrow">Analyse</p>
                    <h2 data-i18n="a_overview_title">Synth√®se d√©taill√©e</h2>
                    <p class="muted" data-i18n="a_overview_subtitle">Extensions dominantes, tailles moyennes et fichiers r√©cents.</p>
                  </div>
                </header>
                <div class="stats-grid" id="analysis-stats"></div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="alerts_eyebrow">Alertes</p>
                    <h2 data-i18n="alerts_title">Points d'attention</h2>
                    <p class="muted" data-i18n="alerts_subtitle">√âtat des plugins, licence Meeting et fonctions inactives.</p>
                  </div>
                </header>
                <ul class="alert-list" id="alert-list"></ul>
              </section>
            </div>

            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="hotspots_eyebrow">Hotspots</p>
                  <h2 data-i18n="hotspots_title">Fichiers √† explorer</h2>
                  <p class="muted" data-i18n="hotspots_subtitle">Classement des fichiers avec le plus de fonctions.</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Hotspots">
                  <thead>
                    <tr>
                      <th data-i18n="hotspots_file">Fichier</th>
                      <th data-i18n="hotspots_detail">D√©tails</th>
                      <th class="numeric" data-i18n="hotspots_rank">Rang</th>
                    </tr>
                  </thead>
                  <tbody id="hotspot-body"></tbody>
                </table>
                <p class="empty" id="hotspot-empty"></p>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="quality" aria-label="Vue qualit√©">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="q_complexity_eyebrow">Complexit√©</p>
                    <h2 data-i18n="q_complexity_title">Complexit√© Cyclomatique</h2>
                    <p class="muted" data-i18n="q_complexity_subtitle">Estimation na√Øve bas√©e sur les structures de contr√¥le.</p>
                  </div>
                </header>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th data-i18n="th_file">Fichier</th>
                        <th class="numeric" data-i18n="th_score">Score</th>
                      </tr>
                    </thead>
                    <tbody id="quality-complexity-body"></tbody>
                  </table>
                  <div id="quality-complexity-empty" class="empty-state" style="display: none;">
                    <p data-i18n="quality_empty">Aucune donn√©e de complexit√©.</p>
                  </div>
                </div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="q_duplication_eyebrow">Duplication</p>
                    <h2 data-i18n="q_duplication_title">Code Dupliqu√©</h2>
                    <p class="muted" data-i18n="q_duplication_subtitle">Clusters de code identique d√©tect√©s.</p>
                  </div>
                </header>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th data-i18n="th_hash">Hash</th>
                        <th class="numeric" data-i18n="th_occurrences">Occurrences</th>
                        <th data-i18n="th_details">D√©tails</th>
                      </tr>
                    </thead>
                    <tbody id="quality-duplication-body"></tbody>
                  </table>
                  <div id="quality-duplication-empty" class="empty-state" style="display: none;">
                    <p data-i18n="quality_empty">Aucune duplication d√©tect√©e.</p>
                  </div>
                </div>
              </section>
            </div>
          </section>

          <section class="view hidden" data-view="diagnostics" aria-label="Vue diagnostic">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="diag_eyebrow">Diagnostic</p>
                    <h2 data-i18n="diag_title">Connectivit√© & contexte</h2>
                    <p class="muted" data-i18n="diag_subtitle">√âtat du serveur API et racine servie.</p>
                  </div>
                </header>
                <div class="stats-grid">
                  <div class="stat-card">
                    <p class="label" data-i18n="served_root">Racine servie</p>
                    <p class="value" id="diag-root" data-i18n="loading">Chargement‚Ä¶</p>
                  </div>
                  <div class="stat-card">
                    <p class="label" data-i18n="diag_api_label">API cible</p>
                    <p class="value" id="api-base-url">http://127.0.0.1:8000</p>
                  </div>
                  <div class="stat-card">
                    <p class="label" data-i18n="diag_scan_label">Scan</p>
                    <p class="value" id="diag-scan-state" data-i18n="diag_scan_missing">En attente</p>
                  </div>
                </div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="live_events_eyebrow">Temps r√©el</p>
                    <h2 data-i18n="live_events_title">√âv√©nements</h2>
                    <p class="muted" data-i18n="live_events_subtitle">Derni√®res actions UI et futures notifications WS.</p>
                  </div>
                </header>
                <div class="live-stream" id="live-stream"></div>
              </section>
            </div>

            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="logs_eyebrow">Logs</p>
                  <h2 data-i18n="logs_title">Historique rapide</h2>
                  <p class="muted" data-i18n="logs_subtitle">Suivi des actions utilisateur et chargements.</p>
                </div>
                <div class="actions">
                    <select id="log-level-filter" class="small" style="padding: 2px 6px; font-size: 12px;">
                        <option value="ALL">All</option>
                        <option value="INFO">Info</option>
                        <option value="WARN">Warn</option>
                        <option value="ERROR">Error</option>
                    </select>
                </div>
              </header>
              <div class="log-stream" id="log-stream"></div>
            </section>
          </section>

          <section class="view hidden" data-view="files" aria-label="Vue fichiers">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="files_eyebrow">Fichiers</p>
                  <h2 data-i18n="files_title">Arborescence scann√©e</h2>
                  <p class="muted" data-i18n="files_subtitle">Tri par taille d√©croissante (top 200).</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Liste des fichiers">
                  <thead>
                    <tr>
                      <th data-i18n="files_path">Chemin</th>
                      <th class="numeric" data-i18n="files_size">Taille</th>
                      <th class="numeric" data-i18n="files_modified">Modifi√©</th>
                      <th class="numeric" data-i18n="files_funcs">Fonctions</th>
                    </tr>
                  </thead>
                  <tbody id="files-body"></tbody>
                </table>
                <p class="empty" id="files-empty"></p>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="functions" aria-label="Vue fonctions">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="functions_eyebrow">Fonctions</p>
                  <h2 data-i18n="functions_title">D√©tail des fonctions</h2>
                  <p class="muted" data-i18n="functions_subtitle">Analyse statique et dynamique.</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Liste des fonctions">
                  <thead>
                    <tr>
                      <th data-i18n="func_name">Nom</th>
                      <th data-i18n="func_file">Fichier</th>
                      <th class="numeric" data-i18n="func_calls">Appels (Dyn)</th>
                      <th data-i18n="func_status">Statut</th>
                    </tr>
                  </thead>
                  <tbody id="functions-body"></tbody>
                </table>
                <p class="empty" id="functions-empty"></p>
              </div>
            </section>

            <section class="panel" style="margin-top: 1rem;">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="graph_eyebrow">Visualisation</p>
                  <h2 data-i18n="graph_title">Graphe d'appels dynamique</h2>
                  <p class="muted" data-i18n="graph_subtitle">Interactions entre fonctions lors de l'ex√©cution.</p>
                </div>
              </header>
              <div class="graph-container" style="position: relative; height: 400px; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden;">
                 <canvas id="dynamic-graph-canvas"></canvas>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="plugins" aria-label="Vue plugins">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="plugins_eyebrow">Extensions</p>
                  <h2 data-i18n="plugins_title">Plugins Jupiter</h2>
                  <p class="muted" data-i18n="plugins_subtitle">√âtat du socle Meeting, qualit√© et notifications.</p>
                </div>
              </header>
              <div class="plugin-list" id="plugin-list"></div>
            </section>
          </section>

          <section class="view hidden" data-view="settings" aria-label="Vue param√®tres">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="s_eyebrow">Param√®tres</p>
                    <h2 data-i18n="s_title">Configuration</h2>
                    <p class="muted" data-i18n="s_subtitle">Modifiez le fichier jupiter.yaml directement.</p>
                  </div>
                </header>
                <form id="settings-form" class="settings-form">
                  <div class="form-group">
                    <label for="conf-server-host">Server Host</label>
                    <input type="text" id="conf-server-host" name="server_host" />
                  </div>
                  <div class="form-group">
                    <label for="conf-server-port">Server Port</label>
                    <input type="number" id="conf-server-port" name="server_port" />
                  </div>
                  <div class="form-group">
                    <label for="conf-gui-host">GUI Host</label>
                    <input type="text" id="conf-gui-host" name="gui_host" />
                  </div>
                  <div class="form-group">
                    <label for="conf-gui-port">GUI Port</label>
                    <input type="number" id="conf-gui-port" name="gui_port" />
                  </div>
                  <div class="form-group">
                    <label for="conf-meeting-enabled">Meeting Enabled</label>
                    <input type="checkbox" id="conf-meeting-enabled" name="meeting_enabled" />
                  </div>
                  <div class="form-group">
                    <label for="conf-meeting-key">Device Key</label>
                    <input type="text" id="conf-meeting-key" name="meeting_device_key" />
                  </div>
                  <div class="form-group">
                    <label for="conf-ui-theme">Theme</label>
                    <select id="conf-ui-theme" name="ui_theme">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="conf-ui-lang">Language</label>
                    <select id="conf-ui-lang" name="ui_language">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                    </select>
                  </div>
                  <div class="form-actions">
                    <button type="submit" class="primary" data-i18n="save_settings">Enregistrer</button>
                  </div>
                </form>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="update_eyebrow">Mise √† jour</p>
                    <h2 data-i18n="update_title">Mettre √† jour Jupiter</h2>
                  </div>
                </header>
                <div class="update-box">
                    <div class="form-group">
                        <label for="update-source">Source (ZIP ou Git URL)</label>
                        <input type="text" id="update-source" placeholder="path/to/update.zip" />
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="update-force" /> Force
                        </label>
                    </div>
                    <button class="primary" data-action="trigger-update" data-i18n="update_btn">Mettre √† jour</button>
                </div>
              </section>
            </div>
          </section>
        </main>
      </div>
    </div>
    <script type="module" src="app.js?v=0.1.4"></script>
    <div style="position: fixed; bottom: 5px; right: 5px; font-size: 10px; color: var(--text-muted); opacity: 0.5;">v0.1.4</div>

    <!-- Modals -->
    <div id="scan-modal" class="modal-overlay hidden">
        <div class="modal">
            <h2 data-i18n="scan_options_title">Options de Scan</h2>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="scan-show-hidden" /> <span data-i18n="scan_opt_hidden">Inclure fichiers cach√©s</span>
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="scan-incremental" /> <span data-i18n="scan_opt_incremental">Scan incr√©mental</span>
                </label>
            </div>
            <div class="form-group">
                <label for="scan-ignore">Ignorer (glob patterns, s√©par√©s par virgule)</label>
                <input type="text" id="scan-ignore" placeholder="*.log, tmp/*" />
            </div>
            <div class="actions">
                <button class="ghost" data-action="close-scan-modal" data-i18n="cancel">Annuler</button>
                <button class="primary" data-action="confirm-scan" data-i18n="start_scan">Lancer</button>
            </div>
        </div>
    </div>

    <div id="run-modal" class="modal-overlay hidden">
        <div class="modal">
            <h2 data-i18n="run_title">Ex√©cuter une commande</h2>
            <div class="form-group">
                <label for="run-command">Commande</label>
                <input type="text" id="run-command" placeholder="python script.py" />
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="run-dynamic" /> <span data-i18n="run_opt_dynamic">Activer l'analyse dynamique</span>
                </label>
            </div>
            <div class="actions">
                <button class="ghost" data-action="close-run-modal" data-i18n="cancel">Annuler</button>
                <button class="primary" data-action="confirm-run" data-i18n="execute">Ex√©cuter</button>
            </div>
            <div id="run-output" class="console-output hidden"></div>
        </div>
    </div>

    <!-- Browser Modal -->
    <dialog id="browser-modal" class="modal">
      <div class="modal-content">
        <header>
          <h3 data-i18n="browser_title">S√©lectionner un dossier</h3>
          <button class="close-btn" data-action="close-modal" title="Fermer">√ó</button>
        </header>
        <div class="browser-body">
          <div class="browser-path">
            <input type="text" id="browser-current-path" readonly />
          </div>
          <ul class="browser-list" id="browser-list"></ul>
        </div>
        <footer>
          <button class="ghost" data-action="close-modal" data-i18n="cancel">Annuler</button>
          <button class="primary" data-action="confirm-path" data-i18n="select">S√©lectionner</button>
        </footer>
      </div>
    </dialog>
  </body>
</html>