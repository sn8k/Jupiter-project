<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title data-i18n="app_title">Jupiter ‚Äì Interface</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div class="brand">
          <span class="logo" aria-hidden="true">ü™ê</span>
          <div>
            <p class="eyebrow">Jupiter</p>
            <h1 data-i18n="main_title">Cartographie &amp; Observabilit√©</h1>
            <p class="muted" data-i18n="main_subtitle">Interface sombre, minimaliste et extensible</p>
          </div>
        </div>
        <div class="header-actions">
          <div class="context">
            <p class="label" data-i18n="current_project">Projet actuel</p>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <p class="value" id="root-path" data-i18n="loading" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 300px;">Chargement‚Ä¶</p>
              <button class="ghost small" data-action="browse-root" title="Parcourir" style="padding: 4px 8px;">üìÇ</button>
            </div>
          </div>
          <div class="actions">
            <button class="ghost" id="user-profile-btn" onclick="openLoginModal()" title="Non connect√©">üë§</button>
            <button class="ghost" data-action="load-sample" data-i18n="sample_button">Exemple</button>
            <button class="primary" data-action="open-scan-modal" data-i18n="scan_button">Scan</button>
            <button class="primary" data-action="open-run-modal" data-i18n="run_button">Run</button>
            <button class="primary" data-action="start-watch" data-i18n="watch_button">Watch</button>
          </div>
        </div>
      </header>

      <div class="app-body">
        <nav class="app-nav" aria-label="Navigation principale">
          <button class="nav-btn active" data-view="dashboard" data-i18n="dashboard_view">Dashboard</button>
          <button class="nav-btn" data-view="analysis" data-i18n="analysis_view">Analyse</button>
          <button class="nav-btn" data-view="quality" data-i18n="quality_view">Qualit√©</button>
          <button class="nav-btn" data-view="diagnostics" data-i18n="diagnostic_view">Diagnostic</button>
          <button class="nav-btn" data-view="files" data-i18n="files_view">Fichiers</button>
          <button class="nav-btn" data-view="functions" data-i18n="functions_view">Fonctions</button>
          <button class="nav-btn" data-view="graph" data-i18n="graph_view">Live Map</button>
          <button class="nav-btn" data-view="api" data-i18n="api_view">API</button>
          <button class="nav-btn" data-view="history" data-i18n="history_view">Historique</button>
          <button class="nav-btn" data-view="projects" data-i18n="projects_view">Projets</button>
          <button class="nav-btn" data-view="settings" data-i18n="settings_view">Param√®tres</button>
          <button class="nav-btn" data-view="plugins" data-i18n="plugins_view">Plugins</button>
          <button class="nav-btn" data-view="suggestions" data-i18n="suggestions_view">Suggestions IA</button>
        </nav>

        <main class="content">
          <section class="view" data-view="dashboard" aria-label="Vue tableau de bord">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="d_pano_eyebrow">Panorama</p>
                    <h2 data-i18n="d_pano_title">√âtat rapide du projet</h2>
                    <p class="muted" data-i18n="d_pano_subtitle">Statut, progression et licence Meeting.</p>
                  </div>
                  <div class="badges" id="status-badges"></div>
                </header>
                <div class="stats-grid" id="stats-grid"></div>
              </section>

              <section class="panel hidden" id="watch-panel">
                <header>
                  <div>
                    <p class="eyebrow">Temps r√©el</p>
                    <h2>Surveillance de fichiers</h2>
                  </div>
                  <div class="badges">
                      <span class="badge active">Watching</span>
                  </div>
                </header>
                <ul id="watch-events" class="event-list" style="max-height: 200px; overflow-y: auto; list-style: none; padding: 0;"></ul>
              </section>

              <section class="panel" id="upload-panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="d_upload_eyebrow">Point d'entr√©e</p>
                    <h2 data-i18n="d_upload_title">Charger un rapport</h2>
                    <p class="muted" data-i18n="d_upload_subtitle">D√©posez un fichier <code>.json</code> g√©n√©r√© par <code>jupiter scan</code> ou utilisez l'exemple.</p>
                  </div>
                </header>
                <div class="uploader" id="dropzone">
                  <div>
                    <p class="muted" data-i18n="d_upload_prompt">Glissez un rapport ou cliquez pour parcourir.</p>
                    <p class="small" data-i18n="d_upload_compat">Compatible avec les scans statiques et les futures analyses incr√©mentales.</p>
                  </div>
                  <input type="file" id="report-input" accept="application/json" />
                </div>
                <div class="upload-meta" id="upload-meta"></div>
              </section>
            </div>
          </section>

          <section class="view hidden" data-view="analysis" aria-label="Vue analyse">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="a_overview_eyebrow">Analyse</p>
                    <h2 data-i18n="a_overview_title">Synth√®se d√©taill√©e</h2>
                    <p class="muted" data-i18n="a_overview_subtitle">Extensions dominantes, tailles moyennes et fichiers r√©cents.</p>
                  </div>
                </header>
                <div class="stats-grid" id="analysis-stats"></div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="alerts_eyebrow">Alertes</p>
                    <h2 data-i18n="alerts_title">Points d'attention</h2>
                    <p class="muted" data-i18n="alerts_subtitle">√âtat des plugins, licence Meeting et fonctions inactives.</p>
                  </div>
                </header>
                <ul class="alert-list" id="alert-list"></ul>
              </section>
            </div>

            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="hotspots_eyebrow">Hotspots</p>
                  <h2 data-i18n="hotspots_title">Fichiers √† explorer</h2>
                  <p class="muted" data-i18n="hotspots_subtitle">Classement des fichiers avec le plus de fonctions.</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Hotspots">
                  <thead>
                    <tr>
                      <th data-i18n="hotspots_file">Fichier</th>
                      <th data-i18n="hotspots_detail">D√©tails</th>
                      <th class="numeric" data-i18n="hotspots_rank">Rang</th>
                    </tr>
                  </thead>
                  <tbody id="hotspot-body"></tbody>
                </table>
                <p class="empty" id="hotspot-empty"></p>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="quality" aria-label="Vue qualit√©">
            <header class="view-header">
              <div>
                <h2 data-i18n="quality_view">Qualit√©</h2>
                <p class="muted" data-i18n="quality_subtitle">M√©triques de qualit√© du code.</p>
              </div>
              <div class="actions">
                 <button class="secondary" data-action="export-quality" data-i18n="export_report">Exporter Rapport</button>
              </div>
            </header>
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="q_complexity_eyebrow">Complexit√©</p>
                    <h2 data-i18n="q_complexity_title">Complexit√© Cyclomatique</h2>
                    <p class="muted" data-i18n="q_complexity_subtitle">Estimation na√Øve bas√©e sur les structures de contr√¥le.</p>
                  </div>
                </header>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th data-i18n="th_file">Fichier</th>
                        <th class="numeric" data-i18n="th_score">Score</th>
                      </tr>
                    </thead>
                    <tbody id="quality-complexity-body"></tbody>
                  </table>
                  <div id="quality-complexity-empty" class="empty-state" style="display: none;">
                    <p data-i18n="quality_empty">Aucune donn√©e de complexit√©.</p>
                  </div>
                </div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="q_duplication_eyebrow">Duplication</p>
                    <h2 data-i18n="q_duplication_title">Code Dupliqu√©</h2>
                    <p class="muted" data-i18n="q_duplication_subtitle">Clusters de code identique d√©tect√©s.</p>
                  </div>
                </header>
                <div class="table-container">
                  <table>
                    <thead>
                      <tr>
                        <th data-i18n="th_hash">Hash</th>
                        <th class="numeric" data-i18n="th_occurrences">Occurrences</th>
                        <th data-i18n="th_details">D√©tails</th>
                      </tr>
                    </thead>
                    <tbody id="quality-duplication-body"></tbody>
                  </table>
                  <div id="quality-duplication-empty" class="empty-state" style="display: none;">
                    <p data-i18n="quality_empty">Aucune duplication d√©tect√©e.</p>
                  </div>
                </div>
              </section>
            </div>
          </section>

          <section class="view hidden" data-view="diagnostics" aria-label="Vue diagnostic">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="diag_eyebrow">Diagnostic</p>
                    <h2 data-i18n="diag_title">Connectivit√© & contexte</h2>
                    <p class="muted" data-i18n="diag_subtitle">√âtat du serveur API et racine servie.</p>
                  </div>
                </header>
                <div class="stats-grid">
                  <div class="stat-card">
                    <p class="label" data-i18n="served_root">Racine servie</p>
                    <p class="value" id="diag-root" data-i18n="loading">Chargement‚Ä¶</p>
                  </div>
                  <div class="stat-card">
                    <p class="label" data-i18n="diag_api_label">API cible</p>
                    <p class="value" id="api-base-url">http://127.0.0.1:8000</p>
                  </div>
                  <div class="stat-card">
                    <p class="label" data-i18n="diag_scan_label">Scan</p>
                    <p class="value" id="diag-scan-state" data-i18n="diag_scan_missing">En attente</p>
                  </div>
                </div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="live_events_eyebrow">Temps r√©el</p>
                    <h2 data-i18n="live_events_title">√âv√©nements</h2>
                    <p class="muted" data-i18n="live_events_subtitle">Derni√®res actions UI et futures notifications WS.</p>
                  </div>
                </header>
                <div class="live-stream" id="live-stream"></div>
              </section>
            </div>

            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="logs_eyebrow">Logs</p>
                  <h2 data-i18n="logs_title">Historique rapide</h2>
                  <p class="muted" data-i18n="logs_subtitle">Suivi des actions utilisateur et chargements.</p>
                </div>
                <div class="actions">
                    <select id="log-level-filter" class="small" style="padding: 2px 6px; font-size: 12px;">
                        <option value="ALL">All</option>
                        <option value="INFO">Info</option>
                        <option value="WARN">Warn</option>
                        <option value="ERROR">Error</option>
                    </select>
                </div>
              </header>
              <div class="log-stream" id="log-stream"></div>
            </section>
          </section>

          <section class="view hidden" data-view="files" aria-label="Vue fichiers">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="files_eyebrow">Fichiers</p>
                  <h2 data-i18n="files_title">Arborescence scann√©e</h2>
                  <p class="muted" data-i18n="files_subtitle">Tri par taille d√©croissante (top 200).</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Liste des fichiers">
                  <thead>
                    <tr>
                      <th data-i18n="files_path" onclick="handleSort('files', 'path')" style="cursor: pointer">Chemin</th>
                      <th class="numeric" data-i18n="files_size" onclick="handleSort('files', 'size_bytes')" style="cursor: pointer">Taille</th>
                      <th class="numeric" data-i18n="files_modified" onclick="handleSort('files', 'modified_timestamp')" style="cursor: pointer">Modifi√©</th>
                      <th class="numeric" data-i18n="files_funcs" onclick="handleSort('files', 'func_count')" style="cursor: pointer">Fonctions</th>
                    </tr>
                  </thead>
                  <tbody id="files-body"></tbody>
                </table>
                <p class="empty" id="files-empty"></p>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="functions" aria-label="Vue fonctions">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="functions_eyebrow">Fonctions</p>
                  <h2 data-i18n="functions_title">D√©tail des fonctions</h2>
                  <p class="muted" data-i18n="functions_subtitle">Analyse statique et dynamique.</p>
                </div>
              </header>
              <div class="table-wrapper">
                <table aria-label="Liste des fonctions">
                  <thead>
                    <tr>
                      <th data-i18n="func_name" onclick="handleSort('functions', 'name')" style="cursor: pointer">Nom</th>
                      <th data-i18n="func_file" onclick="handleSort('functions', 'file')" style="cursor: pointer">Fichier</th>
                      <th class="numeric" data-i18n="func_calls" onclick="handleSort('functions', 'calls')" style="cursor: pointer">Appels (Dyn)</th>
                      <th data-i18n="func_status" onclick="handleSort('functions', 'status')" style="cursor: pointer">Statut</th>
                    </tr>
                  </thead>
                  <tbody id="functions-body"></tbody>
                </table>
                <p class="empty" id="functions-empty"></p>
              </div>
            </section>

            <section class="panel" style="margin-top: 1rem;">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="graph_eyebrow">Visualisation</p>
                  <h2 data-i18n="graph_title">Graphe d'appels dynamique</h2>
                  <p class="muted" data-i18n="graph_subtitle">Interactions entre fonctions lors de l'ex√©cution.</p>
                </div>
              </header>
              <div class="graph-container" style="position: relative; height: 400px; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden;">
                 <canvas id="dynamic-graph-canvas"></canvas>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="api" aria-label="Vue API">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow">Int√©gration</p>
                  <h2>API du Projet</h2>
                  <p class="muted">Endpoints d√©tect√©s via le connecteur configur√©.</p>
                </div>
                <div class="badges" id="api-status-badge"></div>
              </header>
              
              <div class="api-docs-intro" style="margin-bottom: 1rem; padding: 1rem; background: var(--panel-contrast); border-radius: 8px; border: 1px solid var(--border);">
                  <h4 data-i18n="api_docs_title">Documentation & Configuration</h4>
                  <p data-i18n="api_docs_intro">Jupiter analyse automatiquement les endpoints API de votre projet (FastAPI, Flask, Django, etc.).</p>
                  <p data-i18n="api_docs_config">Pour configurer la d√©tection, assurez-vous que votre fichier <code>jupiter.yaml</code> contient la section <code>api</code> correcte.</p>
                  <pre style="background: var(--bg); padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem; overflow-x: auto;">
api:
  connector: "fastapi"  # ou "flask", "django"
  app_var: "app"        # nom de la variable d'application
  path: "src/main.py"   # chemin vers le fichier principal</pre>
              </div>

              <div class="table-wrapper">
                <table aria-label="Endpoints API">
                  <thead>
                    <tr>
                      <th>M√©thode</th>
                      <th>Chemin</th>
                      <th>R√©sum√©</th>
                      <th>Tags</th>
                    </tr>
                  </thead>
                  <tbody id="api-endpoints-body"></tbody>
                </table>
                <p class="empty" id="api-empty">Aucune API configur√©e ou d√©tect√©e.</p>
              </div>
            </section>
          </section>

          <section class="view hidden" data-view="graph" aria-label="Vue Live Map">
            <section class="panel full-height">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="graph_eyebrow">Visualisation</p>
                  <h2 data-i18n="graph_title">Live Map</h2>
                  <p class="muted" data-i18n="graph_subtitle">Graphe de d√©pendances interactif.</p>
                </div>
                <div class="actions">
                  <button class="ghost small" data-action="refresh-graph" data-i18n="graph_refresh">Rafra√Æchir</button>
                </div>
              </header>
              <div id="graph-container" style="width: 100%; height: 600px; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; background: var(--bg-subtle);"></div>
            </section>
          </section>

          <section class="view hidden" data-view="history" aria-label="Vue historique">
            <div class="grid two-cols">
              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="history_eyebrow">Historique</p>
                    <h2 data-i18n="history_title">Snapshots enregistr√©s</h2>
                    <p class="muted" data-i18n="history_subtitle">Chaque scan persiste un instantan√© diffable.</p>
                  </div>
                  <div class="actions">
                    <button class="ghost small" data-action="refresh-snapshots" data-i18n="history_refresh">Rafra√Æchir</button>
                  </div>
                </header>
                <div class="table-wrapper">
                  <table aria-label="Snapshots">
                    <thead>
                      <tr>
                        <th data-i18n="history_col_label">Libell√©</th>
                        <th data-i18n="history_col_date">Date</th>
                        <th class="numeric" data-i18n="history_col_files">Fichiers</th>
                        <th class="numeric" data-i18n="history_col_size">Taille</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="snapshot-table-body"></tbody>
                  </table>
                  <p class="empty hidden" id="snapshots-empty" data-i18n="history_empty">Aucun snapshot enregistr√©.</p>
                </div>
              </section>

              <section class="panel">
                <header>
                  <div>
                    <p class="eyebrow" data-i18n="history_diff_eyebrow">Comparaison</p>
                    <h2 data-i18n="history_diff_title">Comparer deux scans</h2>
                    <p class="muted" data-i18n="history_diff_subtitle">S√©lectionnez deux snapshots pour analyser les √©carts.</p>
                  </div>
                </header>
                <div class="history-controls" style="display: flex; flex-direction: column; gap: 0.75rem;">
                  <div class="selectors" style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                    <label style="flex:1; min-width: 200px;">
                      <span data-i18n="history_select_a">Snapshot A</span>
                      <select id="snapshot-select-a" style="width: 100%;"></select>
                    </label>
                    <label style="flex:1; min-width: 200px;">
                      <span data-i18n="history_select_b">Snapshot B</span>
                      <select id="snapshot-select-b" style="width: 100%;"></select>
                    </label>
                  </div>
                  <div class="actions">
                    <button id="snapshot-diff-btn" class="primary" data-i18n="history_diff_button">Comparer</button>
                  </div>
                </div>
                <div class="history-meta" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 0.75rem; margin-top: 1rem;">
                  <div class="card" id="snapshot-meta-a"></div>
                  <div class="card" id="snapshot-meta-b"></div>
                </div>
                <div class="history-diff" style="margin-top: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);" id="snapshot-diff-output"></div>
              </section>
            </div>
          </section>

          <section class="view hidden" data-view="plugins" aria-label="Vue plugins">
            <section class="panel">
              <header>
                <div>
                  <p class="eyebrow" data-i18n="plugins_eyebrow">Extensions</p>
                  <h2 data-i18n="plugins_title">Plugins Jupiter</h2>
                  <p class="muted" data-i18n="plugins_subtitle">√âtat du socle Meeting, qualit√© et notifications.</p>
                </div>
              </header>
              <div class="plugin-list" id="plugin-list"></div>
            </section>
          </section>

          <section class="view hidden" data-view="settings" aria-label="Vue param√®tres">
            <div class="settings-layout">
                <form id="settings-form" class="settings-form-grid">
                    <!-- Network Section -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_network_title">R√©seau</h3>
                        </header>
                        <div class="form-group">
                            <label for="conf-server-host">Server Host</label>
                            <input type="text" id="conf-server-host" name="server_host" />
                        </div>
                        <div class="form-group">
                            <label for="conf-server-port">Server Port</label>
                            <input type="number" id="conf-server-port" name="server_port" />
                        </div>
                        <div class="form-group">
                            <label for="conf-gui-host">GUI Host</label>
                            <input type="text" id="conf-gui-host" name="gui_host" />
                        </div>
                        <div class="form-group">
                            <label for="conf-gui-port">GUI Port</label>
                            <input type="number" id="conf-gui-port" name="gui_port" />
                        </div>
                    </section>

                    <!-- UI & Meeting Section -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_ui_title">Interface & Meeting</h3>
                        </header>
                        <div class="form-group">
                            <label for="conf-ui-theme">Theme</label>
                            <select id="conf-ui-theme" name="ui_theme">
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conf-ui-lang">Language</label>
                            <select id="conf-ui-lang" name="ui_language">
                                <option value="fr">Fran√ßais</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        <div class="form-group checkbox-group">
                            <label for="conf-meeting-enabled">Meeting Enabled</label>
                            <input type="checkbox" id="conf-meeting-enabled" name="meeting_enabled" />
                        </div>
                        <div class="form-group">
                            <label for="conf-meeting-key">Device Key</label>
                            <input type="text" id="conf-meeting-key" name="meeting_device_key" />
                        </div>
                    </section>

                    <!-- Performance Section (New) -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_perf_title">Performance</h3>
                        </header>
                        <div class="form-group checkbox-group">
                            <label for="conf-perf-parallel">Parallel Scan</label>
                            <input type="checkbox" id="conf-perf-parallel" name="perf_parallel_scan" />
                        </div>
                        <div class="form-group">
                            <label for="conf-perf-workers">Max Workers (0 = Auto)</label>
                            <input type="number" id="conf-perf-workers" name="perf_max_workers" />
                        </div>
                        <div class="form-group">
                            <label for="conf-perf-timeout">Scan Timeout (sec)</label>
                            <input type="number" id="conf-perf-timeout" name="perf_scan_timeout" />
                        </div>
                        <div class="form-group checkbox-group">
                            <label for="conf-perf-graph-simple">Graph Simplification</label>
                            <input type="checkbox" id="conf-perf-graph-simple" name="perf_graph_simplification" />
                        </div>
                        <div class="form-group">
                            <label for="conf-perf-graph-nodes">Max Graph Nodes</label>
                            <input type="number" id="conf-perf-graph-nodes" name="perf_max_graph_nodes" />
                        </div>
                    </section>

                    <!-- Security Section (New) -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_security_title">S√©curit√©</h3>
                        </header>
                        <div class="form-group checkbox-group" title="Autoriser l'ex√©cution de commandes shell via l'interface">
                            <label for="conf-sec-allow-run">Allow Run Command</label>
                            <input type="checkbox" id="conf-sec-allow-run" name="sec_allow_run" />
                        </div>
                    </section>

                    <!-- API Inspection Section (New) -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_api_title">Inspection API</h3>
                        </header>
                        <div class="form-group" title="Framework utilis√© (fastapi, flask, django)">
                            <label for="conf-api-connector">Connector</label>
                            <select id="conf-api-connector" name="api_connector">
                                <option value="">(Aucun)</option>
                                <option value="local">Local (Jupiter)</option>
                                <option value="fastapi">FastAPI</option>
                                <option value="flask">Flask</option>
                                <option value="django">Django</option>
                            </select>
                        </div>
                        <div class="form-group" title="Nom de la variable d'application (ex: app)">
                            <label for="conf-api-app-var">App Variable</label>
                            <input type="text" id="conf-api-app-var" name="api_app_var" placeholder="app" />
                        </div>
                        <div class="form-group" title="Chemin vers le fichier principal (ex: src/main.py)">
                            <label for="conf-api-path">Main File Path</label>
                            <input type="text" id="conf-api-path" name="api_path" placeholder="src/main.py" />
                        </div>
                    </section>
                    
                    <!-- User Management Section (New) -->
                    <section class="panel settings-section">
                        <header>
                            <h3 data-i18n="settings_users_title">Utilisateurs</h3>
                        </header>
                        <div class="table-wrapper">
                            <table aria-label="Utilisateurs">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>R√¥le</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table-body"></tbody>
                            </table>
                        </div>
                        <div class="form-group" style="margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                            <h4 class="small muted">Ajouter un utilisateur</h4>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="text" id="new-user-name" placeholder="Nom" style="flex: 1;" />
                                <input type="text" id="new-user-token" placeholder="Token" style="flex: 1;" />
                                <select id="new-user-role" style="width: 100px;">
                                    <option value="viewer">Viewer</option>
                                    <option value="editor">Editor</option>
                                    <option value="admin">Admin</option>
                                </select>
                                <button type="button" class="primary small" data-action="add-user">Ajouter</button>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Actions -->
                    <div class="settings-actions" style="grid-column: 1 / -1; margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
                        <button type="submit" class="primary" data-i18n="save_settings">Enregistrer</button>
                        <button type="button" class="secondary" data-action="open-raw-config" data-i18n="edit_raw_config">√âditer YAML</button>
                    </div>
                </form>

                <!-- Update Section (Separate) -->
                <section class="panel settings-section" style="margin-top: 2rem;">
                    <header>
                        <h3 data-i18n="update_title">Mise √† jour</h3>
                    </header>
                    <div class="update-box">
                        <div class="form-group">
                            <label for="update-source">Source (ZIP ou Git URL)</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="update-source" placeholder="path/to/update.zip" style="flex: 1;" />
                                <input type="file" id="update-file-input" accept=".zip" style="display: none;" />
                                <button type="button" class="secondary" onclick="document.getElementById('update-file-input').click()">Parcourir...</button>
                            </div>
                        </div>
                        <div class="form-group checkbox-group">
                            <label for="update-force">Force</label>
                            <input type="checkbox" id="update-force" />
                        </div>
                        <button class="primary" data-action="trigger-update" data-i18n="update_btn">Mettre √† jour</button>
                    </div>
                </section>
            </div>
          </section>
          <section class="view hidden" data-view="suggestions" aria-label="Vue Suggestions IA">
            <header class="view-header">
              <div>
                <h2 data-i18n="suggestions_title">Suggestions IA</h2>
                <p class="muted" data-i18n="suggestions_subtitle">Propositions d'am√©lioration et de refactoring.</p>
              </div>
              <div class="actions">
                 <button class="secondary" data-action="refresh-suggestions" data-i18n="refresh">Actualiser</button>
                 <button class="secondary" data-action="export-suggestions" data-i18n="export_report">Exporter Rapport</button>
              </div>
            </header>
            <div class="panel">
               <div id="suggestions-list" class="list-group">
                  <p class="muted">Aucune suggestion pour le moment. Lancez une analyse.</p>
               </div>
            </div>
          </section>

          <section class="view hidden" data-view="projects" aria-label="Vue Projets">
            <header class="view-header">
              <div>
                <h2 data-i18n="projects_title">Gestion des Projets</h2>
                <p class="muted" data-i18n="projects_subtitle">G√©rez vos projets Jupiter et basculez de l'un √† l'autre.</p>
              </div>
              <div class="actions">
                 <button class="primary" data-action="open-project-wizard" data-i18n="add_project">Ajouter un projet</button>
              </div>
            </header>
            <div class="panel">
               <table class="data-table" id="projects-table" style="width: 100%;">
                  <thead>
                    <tr>
                      <th data-i18n="project_name">Nom</th>
                      <th data-i18n="project_path">Chemin</th>
                      <th data-i18n="project_status">Statut</th>
                      <th data-i18n="actions">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Projects will be loaded here -->
                  </tbody>
               </table>
            </div>
          </section>
        </main>
      </div>
    </div>
    <script type="module" src="app.js?v=1.0.1"></script>
    <div style="position: fixed; bottom: 5px; right: 5px; font-size: 10px; color: var(--text-muted); opacity: 0.5;">v1.0.1</div>

    <!-- Modals -->
    <div id="scan-modal" class="modal-overlay hidden">
      <div class="modal">
        <header>
          <h3 data-i18n="scan_modal_title">Lancer un scan</h3>
          <button class="ghost small" data-action="close-scan-modal">‚úï</button>
        </header>
        <div class="modal-body scan-modal-body">
          <div class="scan-options-grid">
            <label class="scan-toggle" for="scan-show-hidden">
              <span data-i18n="scan_opt_hidden">Inclure fichiers cach√©s</span>
              <input type="checkbox" id="scan-show-hidden" />
            </label>
            <label class="scan-toggle" for="scan-incremental">
              <span data-i18n="scan_opt_inc">Scan incr√©mental</span>
              <input type="checkbox" id="scan-incremental" />
            </label>
          </div>
          <div class="form-group scan-ignore-field">
            <label for="scan-ignore" data-i18n="scan_opt_ignore">Ignorer (glob patterns, s√©par√©s par virgule)</label>
            <input type="text" id="scan-ignore" placeholder="*.log, temp/*" />
          </div>
        </div>
        <footer>
          <button class="secondary" data-action="close-scan-modal" data-i18n="cancel">Annuler</button>
          <button class="primary" data-action="confirm-scan" data-i18n="scan_confirm">Scanner</button>
        </footer>
      </div>
    </div>

    <div id="run-modal" class="modal-overlay hidden">
        <div class="modal">
            <header>
                <h3 data-i18n="run_modal_title">Ex√©cuter une commande</h3>
                <button class="ghost small" data-action="close-run-modal">‚úï</button>
            </header>
            <div class="modal-body">
                <div class="form-group">
                    <label for="run-command" data-i18n="run_cmd_label">Commande</label>
                    <input type="text" id="run-command" placeholder="pytest tests/" />
                </div>
                <div class="form-group checkbox-group">
                    <label for="run-dynamic" data-i18n="run_opt_dynamic">Activer l'analyse dynamique (trace)</label>
                    <input type="checkbox" id="run-dynamic" />
                </div>
                <pre id="run-output" class="code-block hidden" style="max-height: 200px; overflow: auto; margin-top: 1rem;"></pre>
            </div>
            <footer>
                <button class="secondary" data-action="close-run-modal" data-i18n="cancel">Fermer</button>
                <button class="primary" data-action="confirm-run" data-i18n="run_confirm">Ex√©cuter</button>
            </footer>
        </div>
    </div>

    <div id="raw-config-modal" class="modal-overlay hidden">
        <div class="modal" style="width: 800px; max-width: 90vw;">
            <header>
                <h3 data-i18n="raw_config_title">√âditeur YAML (jupiter.yaml)</h3>
                <button class="ghost small" data-action="close-raw-config">‚úï</button>
            </header>
            <div class="modal-body">
                <p class="muted small" style="margin-bottom: 1rem;">Attention : Une syntaxe invalide peut emp√™cher le serveur de red√©marrer.</p>
                <textarea id="raw-config-editor" style="width: 100%; height: 400px; font-family: monospace; background: var(--bg-subtle); color: var(--text); border: 1px solid var(--border); padding: 0.5rem;"></textarea>
            </div>
            <footer>
                <button class="secondary" data-action="close-raw-config" data-i18n="cancel">Annuler</button>
                <button class="primary" data-action="save-raw-config" data-i18n="save">Enregistrer</button>
            </footer>
        </div>
    </div>



    <div id="simulation-modal" class="modal-overlay hidden">
        <div class="modal">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>Simulation d'impact</h2>
                <button class="close-btn" onclick="document.getElementById('simulation-modal').classList.add('hidden')">√ó</button>
            </header>
            <div id="simulation-content"></div>
            <div class="actions" style="margin-top: 1rem;">
                <button class="primary" onclick="document.getElementById('simulation-modal').classList.add('hidden')">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Browser Modal -->
    <dialog id="browser-modal" class="modal">
      <div class="modal-content">
        <header>
          <h3 data-i18n="browser_title">S√©lectionner un dossier</h3>
          <button class="close-btn" data-action="close-modal" title="Fermer">√ó</button>
        </header>
        <div class="browser-body">
          <div class="browser-path">
            <input type="text" id="browser-current-path" readonly />
          </div>
          <ul class="browser-list" id="browser-list"></ul>
        </div>
        <footer>
          <button class="ghost" data-action="close-modal" data-i18n="cancel">Annuler</button>
          <button class="primary" data-action="confirm-path" data-i18n="select">S√©lectionner</button>
        </footer>
      </div>
    </dialog>
    <!-- Login Modal -->
    <dialog id="login-modal" class="modal" style="min-width: 350px;">
      <div class="modal-content">
        <header>
          <h2 data-i18n="login_title">Connexion</h2>
        </header>
        <div class="modal-body">
          <form id="login-form" onsubmit="event.preventDefault(); handleLogin();">
            <div class="form-group">
              <label for="login-username">Nom d'utilisateur</label>
              <input type="text" id="login-username" placeholder="admin" required />
            </div>
            <div class="form-group">
              <label for="login-password">Mot de passe (Token)</label>
              <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
            </div>
            <div class="form-group checkbox-group">
              <label for="login-remember">Se souvenir de moi</label>
              <input type="checkbox" id="login-remember" />
            </div>
            <div id="login-error" class="error hidden" style="margin-top: 1rem; color: var(--text-error);"></div>
            <div style="margin-top: 1.5rem; display: flex; justify-content: flex-end;">
              <button type="submit" class="primary" data-i18n="login_button" style="width: 100%;">Connexion</button>
            </div>
          </form>
        </div>
      </div>
    </dialog>

    <!-- Project Wizard Modal -->
    <dialog id="project-wizard-modal" class="modal" style="min-width: 400px;">
      <div class="modal-content">
        <header>
          <h2>Bienvenue sur Jupiter</h2>
        </header>
        <div class="modal-body">
          <p style="margin-bottom: 1rem;">Aucun projet n'est configur√©. Commen√ßons par en cr√©er un.</p>
          <form id="project-wizard-form" onsubmit="event.preventDefault(); handleCreateProject();">
            <div class="form-group">
              <label for="project-path">Chemin du projet (absolu)</label>
              <div style="display: flex; gap: 0.5rem;">
                <input type="text" id="project-path" placeholder="C:\Dev\MonProjet" required style="flex: 1;" />
                <button type="button" class="ghost" onclick="openBrowserForWizard()" title="Parcourir">üìÇ</button>
              </div>
              <p class="small muted">Le dossier doit exister.</p>
            </div>
            <div class="form-group">
              <label for="project-name">Nom du projet</label>
              <input type="text" id="project-name" placeholder="Mon Projet" required />
            </div>
            <div id="project-wizard-error" class="error hidden" style="margin-top: 1rem; color: var(--text-error);"></div>
            <div style="margin-top: 1.5rem; display: flex; justify-content: flex-end;">
              <button type="submit" class="primary" style="width: 100%;">Cr√©er le projet</button>
            </div>
          </form>
        </div>
      </div>
    </dialog>
  </body>
</html>